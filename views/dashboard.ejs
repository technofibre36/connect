<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>InvestConnect — Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa6bd;--accent:#12b886;--danger:#ff6b6b}
        *{box-sizing:border-box}
        body{font-family:Inter,Arial,Helvetica,sans-serif;margin:0;background:linear-gradient(180deg,#071028 0%,#071733 60%);color:#e6eef8}
        header{display:flex;align-items:center;justify-content:space-between;padding:20px 32px;border-bottom:1px solid rgba(255,255,255,0.03)}
        .brand{display:flex;gap:12px;align-items:center}
        .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#0ea5a4);display:flex;align-items:center;justify-content:center;font-weight:700}
        .container{display:grid;grid-template-columns:320px 1fr 360px;gap:20px;padding:28px;max-width:1200px;margin:28px auto}
        .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
        .profile{display:flex;gap:12px;align-items:center}
        .avatar{width:64px;height:64px;border-radius:12px;background:#051018;display:flex;align-items:center;justify-content:center;font-weight:700}
        h2{margin:0 0 8px 0}
        .muted{color:var(--muted);font-size:13px}
        .portfolio{display:flex;flex-direction:column;gap:12px}
        .holding{display:flex;justify-content:space-between;align-items:center;padding:10px;background:rgba(255,255,255,0.01);border-radius:8px}
        .price-up{color:#9ff6c9}
        .price-down{color:#ffb3b3}
        .feed{display:flex;flex-direction:column;gap:12px}
        .post{background:rgba(255,255,255,0.01);padding:12px;border-radius:10px}
        .post .meta{display:flex;justify-content:space-between;align-items:center}
        .actions{display:flex;gap:8px;margin-top:10px}
        .btn{background:var(--accent);color:#042028;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
        .secondary{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted)}
        footer{padding:20px;text-align:center;color:var(--muted);font-size:13px}
        nav .nav-links{display:flex;gap:14px}
        a.link{color:inherit;text-decoration:none;padding:8px 10px;border-radius:8px}
        a.link:hover{background:rgba(255,255,255,0.02)}
    </style>
</head>
<body>
    <header>
        <div class="brand">
            <div class="logo">IC</div>
            <div>
                <div style="font-weight:700">InvestConnect</div>
                <div class="muted" style="font-size:12px">Social investing — share ideas & track portfolios</div>
            </div>
        </div>
        <nav>
            <div class="nav-links">
                <a class="link" href="/">Home</a>
                <a class="link" href="#">Markets</a>
                <a class="link" href="/discover">Discover</a>
                <a class="link" href="#">My Portfolio</a>
                <a class="link" href="/logout">Logout</a>
            </div>
        </nav>
    </header>

    <main class="container">
        <!-- Left: Profile & Portfolio -->
        <aside class="panel">
                        <% if (!user.role || user.role === 'none' || !user.profileComplete) { %>
                            <div style="margin-bottom:14px;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02)">
                                <div style="font-weight:700">Complete your profile</div>
                                <div class="muted">Choose whether you are an investor or a startup CEO to continue.</div>
                                <div style="margin-top:10px;display:flex;gap:8px">
                                    <a class="btn secondary" href="/choose-role" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Choose role</a>
                                    <a class="btn" href="/choose-role">Complete KYC</a>
                                </div>
                            </div>
                        <% } %>
            <div class="profile">
                <div class="avatar"><%= user.name ? user.name.split(' ').map(n=>n[0]).slice(0,2).join('') : 'U' %></div>
                <div>
                    <h3><%= user.name %></h3>
                    <div class="muted"><%= user.email %></div>
                </div>
            </div>

            <hr style="margin:14px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

            <h4 style="margin:0 0 10px 0">Portfolio</h4>
            <div class="portfolio">
                <div class="holding">
                    <div>
                        <div style="font-weight:600">AAPL</div>
                        <div class="muted">Apple Inc.</div>
                    </div>
                    <div style="text-align:right">
                        <div style="font-weight:700">$173.24</div>
                        <div class="price-up muted">+1.2%</div>
                    </div>
                </div>
                <div class="holding">
                    <div>
                        <div style="font-weight:600">TSLA</div>
                        <div class="muted">Tesla</div>
                    </div>
                    <div style="text-align:right">
                        <div style="font-weight:700">$249.11</div>
                        <div class="price-down muted">-0.8%</div>
                    </div>
                </div>
                <button class="btn" style="width:100%;margin-top:8px">View Full Portfolio</button>
            </div>
        </aside>

        <!-- Center: Feed -->
        <section class="panel">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                <h2>Community Feed</h2>
                <div class="muted">Real-time ideas from investors</div>
            </div>

            <div style="margin-bottom:12px">
                <form id="postForm">
                    <textarea id="postText" placeholder="Share a trade idea, watchlist, or market thought" style="width:100%;resize:none;height:70px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit"></textarea>
                    <div style="display:flex;justify-content:space-between;margin-top:8px">
                        <div class="muted">Posting as <strong><%= user.name %></strong></div>
                        <div>
                            <button class="secondary" type="button" onclick="document.getElementById('postText').value=''">Clear</button>
                            <button class="btn" type="button" onclick="addPost()">Post</button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="feed" id="feed">
                <div class="post">
                    <div class="meta">
                        <div>
                            <strong>MarketGuru</strong> <span class="muted">• 2h ago</span>
                            <div class="muted">Buying AAPL on the dip — strong earnings coming.</div>
                        </div>
                        <div style="text-align:right">▲ +3.4%</div>
                    </div>
                    <div class="actions">
                        <button class="secondary">Comment</button>
                        <button class="secondary">Share</button>
                        <button class="btn">Follow</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Right: Market Snapshot -->
        <aside class="panel">
            <h4>Market Snapshot</h4>
            <div style="display:flex;flex-direction:column;gap:10px;margin-top:10px">
                <div style="display:flex;justify-content:space-between">
                    <div class="muted">S&P 500</div>
                    <div>4,536 ▲ <span style="color:#9ff6c9">+0.9%</span></div>
                </div>
                <div style="display:flex;justify-content:space-between">
                    <div class="muted">NASDAQ</div>
                    <div>13,212 ▲ <span style="color:#9ff6c9">+1.4%</span></div>
                </div>
                <div style="display:flex;justify-content:space-between">
                    <div class="muted">Dow</div>
                    <div>35,021 ▼ <span style="color:#ffb3b3">-0.2%</span></div>
                </div>
            </div>

            <hr style="margin:14px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">
            <h4>Watchlist</h4>
            <ul style="list-style:none;padding:0;margin:8px 0;display:flex;flex-direction:column;gap:8px">
                <li style="display:flex;justify-content:space-between"><span>AAPL</span><span class="muted">$173</span></li>
                <li style="display:flex;justify-content:space-between"><span>TSLA</span><span class="muted">$249</span></li>
                <li style="display:flex;justify-content:space-between"><span>AMZN</span><span class="muted">$3,451</span></li>
            </ul>
        </aside>
    </main>

    <footer>
        InvestConnect — share your investing ideas responsibly.
    </footer>

    <script>
        function addPost(){
            const text = document.getElementById('postText').value.trim();
            if(!text) return alert('Write something to post');
            const feed = document.getElementById('feed');
            const div = document.createElement('div');
            div.className='post';
            div.innerHTML = `<div class="meta"><div><strong><%= user.name %></strong> <span class="muted">• just now</span><div class="muted">${escapeHtml(text)}</div></div><div></div></div><div class="actions"><button class="secondary">Comment</button><button class="secondary">Share</button><button class="btn">Follow</button></div>`;
            feed.prepend(div);
            document.getElementById('postText').value='';
        }
        function escapeHtml(unsafe){return unsafe.replace(/[&<>"']/g,function(m){return{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;"}[m]});}
    </script>
</body>
</html>
